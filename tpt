#!/usr/bin/env python3
# -*- coding: utf-8 -*-

"""
TPT - La Herramienta de Paquetes Total
Punto de entrada principal para la aplicación.
"""

import sys
from pathlib import Path

# Añadir el directorio del proyecto al path de Python para poder importar los módulos
project_dir = Path(__file__).parent / 'tpt_project'
sys.path.insert(0, str(project_dir.parent))

from tpt_project.core.config import Configuracion
from tpt_project.utils.logger import setup_logger, HAS_RICH
from tpt_project.core.package_manager import PackageManager
from tpt_project.cli import CLI, HAS_RICH as HAS_RICH_CLI

def main():
    """Inicializa y ejecuta la aplicación TPT."""
    
    if not HAS_RICH or not HAS_RICH_CLI:
        print("Error: La librería 'rich' no está instalada. TPT la necesita para funcionar.", file=sys.stderr)
        print("Por favor, instálala con: pip install rich", file=sys.stderr)
        sys.exit(1)

    # 1. Cargar configuración y asegurar directorios
    config = Configuracion()
    try:
        config.asegurar_directorios()
    except Exception as e:
        print(f"Error crítico al inicializar directorios: {e}", file=sys.stderr)
        sys.exit(1)

    # 2. Inicializar los componentes del núcleo
    logger = setup_logger(config)
    pm = PackageManager(config, logger)
    
    # 3. Lanzar la interfaz de línea de comandos
    cli = CLI(pm, logger)
    cli.run()

if __name__ == "__main__":
    main()
